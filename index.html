<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/styles.css" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://spark.pearson.com/assets/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://spark.pearson.com/assets/favicon/favicon-16x16.png"
    />
    <title>Spark Reading</title>
  </head>
  <body>
    <header>
      <div>
        <a
          class="header-logo"
          href="https://www.pearson.com/en-ca.html"
          target="blank"
          ><img
            src="https://spark.pearson.com/assets/logo.svg"
            class="header-logo"
            alt="Pearson logo"
        /></a>
      </div>
    </header>
    <section class="container select-classroom">
      <h2>Select Your Classroom</h2>
      <div class="classroom-selection-list">
        <!-- <div class="class-item-container">
          <div class="class-logo"></div>
          <div class="class-name">Susan's Class</div>
          <div class="class-btn">
            <button class="button edit">Edit</button>
          </div>
        </div> -->
      </div>
      <button class="button primary">Create Classroom</button>
    </section>
    <section class="container edit-classroom">
      <div class="class-logo edit"></div>
      <input
        type="text"
        class="text-input"
        id="class-name"
        placeholder="CLASS NAME"
      />
      <h2 class="create-header">What is your class code?</h2>
      <h2 class="class-code-header"></h2>
      <input
        type="text"
        class="text-input"
        id="class-code"
        placeholder="YOUR CODE"
        maxlength="6"
      />
      <div class="btn-container">
        <button class="button cancel">Cancel</button>
        <button class="button save" disabled>Save</button>
      </div>
      <button id="delete-btn" class="button danger">Delete Classroom</button>
      <h3 class="footer-note">Your class code is provided by your teacher</h3>
    </section>

    <script>
      const selectClassroomSection =
        document.querySelector(".select-classroom");
      const editClassroomSection = document.querySelector(".edit-classroom");
      const createButton = document.querySelector(".button.primary");
      const saveButton = document.querySelector(".button.save");
      const cancelButton = document.querySelector(".button.cancel");
      const classNameInput = document.getElementById("class-name");
      const classCodeInput = document.getElementById("class-code");
      const deleteBtn = document.getElementById("delete-btn");
      const footerNote = document.querySelector(".footer-note");
      const classCodeHeader = document.querySelector(".class-code-header");
      const createHeader = document.querySelector(".create-header");

      // Array to store classrooms
      let classrooms = [];

      // Function to check if Save button should be enabled
      function validateInputs() {
        const className = classNameInput.value.trim();
        const classCode = classCodeInput.value.trim();

        saveButton.disabled = !(className && classCode.length === 6);
      }

      // Function to show edit classroom and hide select classroom
      function showEditClassroom() {
        selectClassroomSection.style.display = "none";
        editClassroomSection.style.display = "flex";
      }

      // Function to show select classroom and hide edit classroom
      function showSelectClassroom() {
        selectClassroomSection.style.display = "flex";
        editClassroomSection.style.display = "none";
      }

      // Function to handle the "Edit" action
      function handleEditClassroom(event) {
        if (event.target.classList.contains("edit")) {
          const classItem = event.target.closest(".class-item-container");
          const classCode = classItem.dataset.classCode;

          // Find the classroom in the array
          const classroom = classrooms.find(
            (cls) => cls.classCode === classCode
          );

          createHeader.style.display = "none";
          footerNote.style.display = "none";
          deleteBtn.style.display = "block";
          classCodeHeader.style.display = "block";

          // Update the class code header
          if (classroom) {
            classCodeHeader.textContent = `Your Class Code: ${classCode}`;
            // Populate the inputs with the selected class details
            classNameInput.value = classroom.className;
            classCodeInput.value = classroom.classCode;
            classCodeInput.readOnly = true;
            classCodeInput.disabled = true;

            // Validate inputs to enable the Save button if conditions are met
            validateInputs();

            // Show the edit classroom section
            showEditClassroom();
          }
        }
      }

      // Function to handle the "Create" action
      function handleCreateClassroom() {
        // Clear input fields
        classNameInput.value = "";
        classCodeInput.value = "";
        saveButton.disabled = true; // Disable the save button initially
        createHeader.style.display = "block";
        footerNote.style.display = "block";
        deleteBtn.style.display = "none";
        classCodeHeader.style.display = "none";

        // Update the class code header
        classCodeHeader.textContent = "";

        // Show the edit classroom section
        showEditClassroom();
      }

      // Attach event listener for the "Edit" button click
      document
        .querySelector(".classroom-selection-list")
        .addEventListener("click", handleEditClassroom);

      // Attach event listener for the "Create Classroom" button click
      createButton.addEventListener("click", handleCreateClassroom);

      deleteBtn.addEventListener("click", deleteClassroom);

      function deleteClassroom() {
        const classCode = classCodeInput.value.trim();

        // Remove the classroom from the array
        classrooms = classrooms.filter((cls) => cls.classCode !== classCode);

        // Update the UI
        renderClassroomList();

        // Reset the form
        classNameInput.value = "";
        classCodeInput.value = "";
        saveButton.disabled = true;

        // Show select classroom and hide edit classroom
        showSelectClassroom();
      }

      // Function to render the classroom list
      function renderClassroomList() {
        const classroomList = document.querySelector(
          ".classroom-selection-list"
        );
        classroomList.innerHTML = "";

        classrooms.forEach((classroom) => {
          const classItem = document.createElement("div");
          classItem.className = "class-item-container";
          classItem.dataset.classCode = classroom.classCode;
          classItem.innerHTML = `
            <div class="class-logo"></div>
            <div class="class-name">${classroom.className}</div>
            <div class="class-btn">
              <button class="button edit">Edit</button>
            </div>
          `;
          classroomList.appendChild(classItem);
        });
      }

      // Transform class code to uppercase
      classCodeInput.addEventListener("input", function () {
        this.value = this.value.toUpperCase();
        validateInputs();
      });

      // Validate class name input
      classNameInput.addEventListener("input", validateInputs);

      // Event listener for the "Cancel" button to go back to the classroom list
      cancelButton.addEventListener("click", showSelectClassroom);

      // Event listener for the "Save" button to save the classroom details
      saveButton.addEventListener("click", async function () {
        const className = classNameInput.value.trim();
        const classCode = classCodeInput.value.trim();

        if (className) {
          try {
            // const response = await fetch(
            //   `https://spark2-stg.pearson.com/api/checkClassCode/${classCode}`
            // );
            // const isValidCode = await response.json();
            const isValidCode = true;

            if (isValidCode) {
              // Check if the class already exists in the array
              const existingClassroomIndex = classrooms.findIndex(
                (cls) => cls.classCode === classCode
              );

              if (existingClassroomIndex !== -1) {
                // Update the existing classroom
                classrooms[existingClassroomIndex].className = className;
              } else {
                // Add the new classroom to the array
                classrooms.push({ className, classCode });
              }

              // Update the UI
              renderClassroomList();

              // Reset the form
              classNameInput.value = "";
              classCodeInput.value = "";
              saveButton.disabled = true;

              // Show select classroom and hide edit classroom
              showSelectClassroom();
            } else {
              alert("Wrong class code. Please try again.");
            }
          } catch (error) {
            console.error("Error:", error);
            alert("There was an error validating the class code.");
          }
        }
      });
    </script>
  </body>
</html>
